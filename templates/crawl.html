<!DOCTYPE html>
<html>
<head>
    <title>Crawl - LibraryBuilder</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script>
        function startProgress() {
            const source = new EventSource('/crawl_progress');
            const progressDiv = document.getElementById('progress');
            source.onmessage = function(event) {
                const data = JSON.parse(event.data);
                progressDiv.innerHTML = `
                    Links Found: ${data.links_found}<br>
                    Links Scanned: ${data.links_scanned}<br>
                    Pages Crawled: ${data.items_crawled}<br>
                    Status: ${data.status}
                `;
                if (data.status === 'complete' || data.status.startsWith('error')) {
                    source.close();
                }
            };
            source.onerror = function() {
                progressDiv.innerHTML = 'Error fetching progress.';
                source.close();
            };
        }
        window.onload = function() {
            if (document.getElementById('progress')) {
                startProgress();
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <header>
            <img src="/static/logo.png" alt="LibraryBuilder Logo" class="logo">
            <nav>
                <a href="/">Home</a>
                <a href="/libraries">Libraries</a>
                <a href="/prompts">Prompts</a>
                <a href="/crawl">Crawl</a>
                <a href="/search">Search</a>
                <a href="/logout">Logout</a>
            </nav>
        </header>
        <main>
            <h1>Crawl Website</h1>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <p class="{{ category }}">{{ message }}</p>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <form method="post">
                <label for="url">Website URL:</label>
                <input type="text" id="url" name="url" required>
                <label for="library_id">Select Library:</label>
                <select id="library_id" name="library_id" required>
                    <option value="">Select a library</option>
                    {% for library in libraries %}
                        <option value="{{ library[0] }}">{{ library[1] }}</option>
                    {% endfor %}
                </select>
                <button type="submit" onclick="startProgress()">Start Crawl</button>
            </form>
            <div id="progress">Waiting for crawl progress...</div>
        </main>
    </div>
</body>
</html>